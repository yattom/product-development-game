# ゲーム状態の不変性に関する決定

## ステータス

承認済み

## コンテキスト

本プロジェクトでは、複雑なゲームロジックと多様なルールバリアントを効率的に管理し、将来的な拡張性、デバッグの容易さ、およびAI開発の効率化を実現する必要がある。特に、ゲームの状態変更に伴う副作用の抑制が課題となっていた。

## 決定

**状態管理における不変性（Immutability）の採用**:
ゲームの状態（`GameState`）を変更する際、既存の状態を直接書き換えるのではなく、変更箇所のみを新しく作成し、新しい状態オブジェクトを生成する。これにより、状態の変更は常に新しいオブジェクトとして表現される。

## 結果

この決定により、以下のメリットが期待される。

* **デバッグの容易さ**: 状態が意図せず変更されるバグ（副作用）を防ぎ、問題の特定と修正が容易になる。
* **機能実装の簡潔化**: 「元に戻す（Undo）」機能やゲームのリプレイ再生が容易に実装可能となる。
* **AI開発の効率化**: AIが現在のゲーム状態を破壊することなく、未来の状態を安全にシミュレーションできるようになる。

パフォーマンス面では、「構造共有」の考え方により、変更されなかった大部分の状態は参照で共有されるため、コピーのコストは変更された部分のみに限定され、パフォーマンスの低下はほとんどない。

## 選択肢

### 可変な状態管理（不採用）

ゲームの状態を直接変更するアプローチ。

* **長所**: 実装が直感的で、初期開発速度が速い可能性がある。
* **短所**:
  * デバッグの困難さ: 状態が意図せず変更される「副作用」によるバグが発生しやすく、原因特定が難しい。
  * 機能実装の複雑化: 「元に戻す」機能やリプレイ機能の実装が複雑になる。
  * AIシミュレーションの困難さ: 現在の状態を破壊せずに未来の状態をシミュレーションすることが難しい。

## 議論

なし
